{% extends "users/sidebar.html" %}
{% comment %}
Re2o est un logiciel d'administration développé initiallement au rezometz. Il
se veut agnostique au réseau considéré, de manière à être installable en
quelques clics.

Copyright © 2017  Gabriel Détraz
Copyright © 2017  Goulven Kermarec
Copyright © 2017  Augustin Lemesle

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
{% endcomment %}

{% load bootstrap3 %}
{% load acl %}
{% block title %}Profil{% endblock %}
{% block content %}
<h2>{{ users.surname }} {{users.name}}</h2>
<p>Vous êtes {% if users.end_adhesion != None %}<span class="label label-success">
un {{ users.class_name | lower}}</span>{% else %}<span class="label label-danger">
non adhérent</span>{% endif %} et votre connexion est {% if users.has_access %}
<span class="label label-success">active</span>{% else %}<span class="label label-danger">désactivée</span>{% endif %}.</p>
{% if user_solde %}
<p>Votre solde est de <span class="badge">{{ user.solde }}€</span>.
{% if allow_online_payment %}
<a class="btn btn-primary btn-sm" role="button" href="{% url 'cotisations:recharge' %}">
    <i class="glyphicon glyphicon-piggy-bank"></i>
    Recharger
</a>
{% endif %}
</p>
{% endif %}

<div class="panel-group" id="accordion">
	<div class="panel panel-default">
        <div class="panel-heading clearfix" data-parent="#accordion" data-toggle="collapse" data-target="#collapse1">
            <h3 class="panel-title pull-left" >
                    Informations détaillées
            </h3>
            <div class="dropdown pull-right">
                <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="editionuser" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <i class="fa fa-edit"></i> Édition<span class="caret"></span></button>
                <ul class="dropdown-menu" arialabelledby="editionuser">
                    <li>
                        <a href="{% url 'users:edit-info' users.id %}">
                            <i class="fa fa-edit"></i>
                            Editer
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'users:password' users.id %}">
                            <i class="fa fa-lock"></i>
                            Changer le mot de passe
                        </a>
                    </li>
        	        {% can_change User state %}
                    <li>
                        <a href="{% url 'users:state' users.id %}">
                            <i class="fa fa-id-badge"></i>
                            Changer le statut
                        </a>
                    </li>
        	        {% acl_end %}
                    {% can_change User groups %}
                    <li>
        	            <a href="{% url 'users:groups' users.id %}">
        	                <i class="fa fa-check"></i>
                            Gérer les groupes
                        </a>
                    </li>
        	        {% acl_end %}
                    <li>
        	            <a href="{% url 'users:history' 'user' users.id %}">
                            <i class="fa fa-history"></i>
                            Historique
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="panel-collapse collapse in" id="collapse1">
            <div class="panel-body">
                <table class="table table-striped">
                    <tr>
                        <th>Prénom</th>
                        <td>{{ users.name }}</td>
                        <th>Nom</th>
                        <td>{{ users.surname }}</td>
                    </tr>
                    <tr>
                        <th>Pseudo</th>
                        <td>{{ users.pseudo }}</td>
                        <th>E-mail</th>
                        <td>{{ users.email }}</td>
                    </tr>
                    <tr>
                        <th>Chambre</th>
                        <td>{{ users.room }}</td>
                        <th>Téléphone</th>
            	    <td>{{ users.telephone }}</td>
                    </tr>
                    <tr>
                        <th>École</th>
                        <td>{{ users.school }}</td>
                        <th>Commentaire</th>
                        <td>{{ users.comment }}</td>
                    </tr>
                    <tr>
                        <th>Date d'inscription</th>
                        <td>{{ users.registered }}</td>
                        <th>Dernière connexion</th>
                        <td>{{ users.last_login }}</td>
                    </tr>
                    <tr>
                        <th>Fin d'adhésion</th>
                        {% if users.end_adhesion != None %}
                        <td><i class="text-success">{{ users.end_adhesion }}</i></td>
                        {% else %}
                        <td><i class="text-danger">Non adhérent</i></td>
                        {% endif %}
                        <th>Accès gracieux</th>
                        {% if users.end_whitelist != None %}
                        <td><i class="text-success">{{ users.end_whitelist }}</i></td>
                        {% else %}
                        <td><i class="text-warning">Aucun</i></td>
                        {% endif %}
                    <tr>
                        <th>Bannissement</th>
                        {% if users.end_ban != None %}
                        <td><i class="text-danger">{{ users.end_ban }}</i></td>
                        {% else %}
                        <td><i class="text-success">Non banni</i></td>
                        {% endif %}
                        <th>Statut</th>
                        {% if users.state == 0 %}
                        <td><i class="text-success">Actif</i></td>
                        {% elif users.state == 1 %}
                        <td><i class="text-danger">Désactivé</i></td>
                        {% else %}
                        <td><i class="text-warning">Archivé</i></td>
                        {% endif %}
                    </tr>
                    <tr>
                        <th>Accès internet</th>
                        {% if users.has_access == True %}
            	    <td><i class="text-success">Actif (jusqu'au {{ users.end_access }})</i></td>
                        {% else %}
                        <td><i class="text-danger">Désactivé</i></td>
                        {% endif %}
                        <th>Groupes</th>
                        {% if users.groups.all %}
            	    <td>{{ users.groups.all|join:", "}}</td>
                        {% else %}
                        <td>Aucun</td>
                        {% endif %}
                    </tr>
                    {% if allow_online_payment %}
                    <tr>
                        <th>Solde</th>
                        <td>{{ users.solde }} €
            		    <a class="btn btn-primary btn-sm" style='float:right' role="button" href="{% url 'cotisations:recharge' %}">
                                <i class="glyphicon glyphicon-piggy-bank"></i>
                                Recharger
                            </a>
                        </td>
            	{% endif %}
            	{% if users.shell %}
            	    <th>Shell</th>
            	    <td>{{ users.shell }}</td>
            	{% endif %}
                    </tr>
                </table>
            </div>
        </div>
    </div>
    {% if users.is_class_club %}
    <div class="panel panel-default">
        <div class="panel-heading clearfix" data-parent="#accordion" data-toggle="collapse" data-target="#collapse2">
            <h3 class="panel-title pull-left">
                Gérer le club
            </h3>
            <div class="btn-group pull-right">
                <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:edit-club-admin-members' users.club.id %}">
                    <i class="fa fa-lock"></i>
                    Gérer admin et membres
                </a>
            </div>
        </div>
        <div class="panel-collapse collapse" id="collapse2">
            <div class="panel-body">
                                <h4>Administrateurs du club</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Prenom</th>
                            <th>Pseudo</th>
                        </tr>
                    </thead>
                    {% for admin in users.club.administrators.all %}
                    <tr>
                        <td>{{ admin.surname }}</td>
                        <td>{{ admin.name }}</td>
            	    <td>{{ admin.pseudo }}</td>
                    </tr>
                    {% endfor %}
                </table>
                <h4>Membres</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Prenom</th>
                            <th>Pseudo</th>
                        </tr>
                    </thead>
                    {% for admin in users.club.members.all %}
                    <tr>
                        <td>{{ admin.surname }}</td>
                        <td>{{ admin.name }}</td>
            	    <td>{{ admin.pseudo }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="panel panel-default">
        <div class="panel-heading clearfix" data-parent="#accordion" data-toggle="collapse" data-target="#collapse3">
            <h3 class="panel-title pull-left">
                Machines
                <span class="badge">{{machines_list.count}}</span>
            </h3>
            <a class="btn btn-primary btn-sm pull-right" role="button" href="{% url 'machines:new-machine' users.id %}"><i class="fa fa-desktop"></i> Ajouter une machine</a>
        </div>
        <div id="collapse3" class="panel-collapse collapse">
            <div class="panel-body">
                {% if machines_list %}
                {% include "machines/aff_machines.html" with machines_list=machines_list %}
                {% else %}
                <p>Aucune machine</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading clearfix" data-parent="#accordion" data-toggle="collapse" data-target="#collapse4">
            <h3 class="panel-title pull-left">
                Cotisations
            </h3>
            <div class="btn-group pull-right">
                {% can_create Facture %}
                <a class="btn btn-primary btn-sm" role="button" href="{% url 'cotisations:new-facture' users.id %}">
                    <i class="glyphicon glyphicon-piggy-bank"></i>
                    Ajouter une cotisation
                </a>
                {% if user_solde %}
                <a class="btn btn-primary btn-sm" role="button" href="{% url 'cotisations:credit-solde' users.id %}">
                    <i class="glyphicon glyphicon-piggy-bank"></i>
                    Modifier le solde
                </a>
                {% endif%}{% acl_else %}
                {% if user_solde %}
                <a class="btn btn-primary btn-sm" role="button" href="{% url 'cotisations:new_facture_solde' user.id %}">
                    <i class="glyphicon glyphicon-piggy-bank"></i>
                    Ajouter une cotisation par solde</a>{% endif %}{% acl_end %}
            </div>
        </div>
        <div id="collapse4" class="panel-collapse collapse">
            <div class="panel-body">
                {% if facture_list %}
                {% include "cotisations/aff_cotisations.html" with facture_list=facture_list %}
                {% else %}
                <p>Aucune facture</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading clearfix" data-parent="#accordion" data-toggle="collapse" data-target="#collapse5">
            <h3 class="panel-title pull-left">
                Bannissements
            </h3>
            <div class="btn-group pull-right">
                {% can_create Ban %}
                <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:add-ban' users.id %}">
                    <i class="fa fa-ban"></i>
                    Ajouter un bannissement
                </a>{% acl_end %}
            </div>
        </div>
        <div id="collapse5" class="panel-collapse collapse">
            <div class="panel-body">
                {% if ban_list %}
                {% include "users/aff_bans.html" with ban_list=ban_list %}
                {% else %}
                <p>Aucun bannissement</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading clearfix" data-parent="#accordion" data-toggle="collapse" data-target="#collapse6">
            <h3 class="panel-title pull-left">
                Accès à titre gracieux
            </h3>
            <div class="btn-group pull-right">
                {% can_create Whitelist %}
                <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:add-whitelist' users.id %}">
                    <i class="fa fa-check-circle"></i>
                    Accorder un accès à titre gracieux
                </a>
                {% acl_end %}
            </div>
        </div>
        <div id="collapse6" class="panel-collapse collapse">
            <div class="panel-body">
                {% if white_list %}
                {% include "users/aff_whitelists.html" with white_list=white_list %}
                {% else %}
                <p>Aucun accès gracieux</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<br />
<br />
<br />
{% endblock %}
