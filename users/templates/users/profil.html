{% extends "users/sidebar.html" %}
{% comment %}
Re2o est un logiciel d'administration développé initiallement au rezometz. Il
se veut agnostique au réseau considéré, de manière à être installable en
quelques clics.

Copyright © 2017  Gabriel Détraz
Copyright © 2017  Goulven Kermarec
Copyright © 2017  Augustin Lemesle

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
{% endcomment %}

{% load bootstrap3 %}

{% block title %}Profil{% endblock %}

{% block content %}
<h2>{{ user.class_name }}</h2>
    <div>
        <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:edit-info' user.id %}">
            <i class="glyphicon glyphicon-edit"></i>
            Editer
        </a>
        <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:password' user.id %}">
            <i class="glyphicon glyphicon-lock"></i>
            Changer le mot de passe
        </a>
        {% if is_bureau %}
        <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:state' user.id %}">
            <i class="glyphicon glyphicon-flash"></i>
            Changer le statut
        </a>
        <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:add-right' user.id %}">
            <i class="glyphicon glyphicon-ok"></i>
            Ajouter un droit
        </a>
        {% endif %}
        <a class="btn btn-info btn-sm" role="button" href="{% url 'users:history' 'user' user.id %}">
            <i class="glyphicon glyphicon-time"></i>
            Historique
        </a>
    </div>
    <p>
        <br />
    </p>
    <table class="table table-striped">
        <tr>
            <th>Prénom</th>
            <td>{{ user.name }}</td>
            <th>Nom</th>
            <td>{{ user.surname }}</td>
        </tr>
        <tr>
            <th>Pseudo</th>
            <td>{{ user.pseudo }}</td>
            <th>E-mail</th>
            <td>{{ user.email }}</td>
        </tr>
        <tr>
            <th>Chambre</th>
            <td>{{ user.room }}</td>
            <th>Téléphone</th>
        <td>{{ user.telephone }}</td>
        </tr>
        <tr>
            <th>École</th>
            <td>{{ user.school }}</td>
            <th>Commentaire</th>
            <td>{{ user.comment }}</td>
        </tr>
        <tr>
            <th>Date d'inscription</th>
            <td>{{ user.registered }}</td>
            <th>Dernière connexion</th>
            <td>{{ user.last_login }}</td>
        </tr>
        <tr>
            <th>Fin d'adhésion</th>
            {% if user.end_adhesion != None %}
            <td><i class="text-success">{{ user.end_adhesion }}</i></td>
            {% else %}
            <td><i class="text-danger">Non adhérent</i></td>
            {% endif %}
            <th>Accès gracieux</th>
            {% if user.end_whitelist != None %}
            <td><i class="text-success">{{ user.end_whitelist }}</i></td>
            {% else %}
            <td><i class="text-warning">Aucun</i></td>
            {% endif %}
        <tr>
            <th>Bannissement</th>
            {% if user.end_ban != None %}
            <td><i class="text-danger">{{ user.end_ban }}</i></td>
            {% else %}
            <td><i class="text-success">Non banni</i></td>
            {% endif %}
            <th>Statut</th>
            {% if user.state == 0 %}
            <td><i class="text-success">Actif</i></td>
            {% elif user.state == 1 %}
            <td><i class="text-danger">Désactivé</i></td>
            {% else %}
            <td><i class="text-warning">Archivé</i></td>
            {% endif %}
        </tr>
        <tr>
            <th>Accès internet</th>
            {% if user.has_access == True %}
        <td><i class="text-success">Actif (jusqu'au {{ user.end_access }})</i></td>
            {% else %}
            <td><i class="text-danger">Désactivé</i></td>
            {% endif %}
            <th>Droits</th>
            {% if list_droits %}
            <td>{% for droit in list_droits %}{{ droit.right }}{% if list_droits|length != forloop.counter %}  - {% endif %} {% endfor %}</td>
            {% else %}
            <td>Aucun</td>
            {% endif %}
        </tr>
    {% if user_solde %}
        <tr>
            <th>Solde</th>
            <td>{{ user.solde }} €</td>
        </tr>
    {% endif %}
    {% if user.shell %}
        <th>Shell</th>
        <td>{{ user.shell }}</td>
    {% endif %}
    </table>
    {% if user.is_class_club %}
    <a class="btn btn-primary btn-sm" role="button" href="{% url 'users:edit-club-admin-members' user.club.id %}">
        <i class="glyphicon glyphicon-lock"></i>
        Gérer admin et membres
    </a>
    <h3>Administrateurs du club</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Prenom</th>
                <th>Pseudo</th>
            </tr>
        </thead>
        {% for admin in user.club.administrators.all %}
        <tr>
            <td>{{ admin.surname }}</td>
            <td>{{ admin.name }}</td>
	    <td>{{ admin.pseudo }}</td>
        </tr>
        {% endfor %}
    </table>
    <h3>Membres</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Prenom</th>
                <th>Pseudo</th>
            </tr>
        </thead>
        {% for admin in user.club.members.all %}
        <tr>
            <td>{{ admin.surname }}</td>
            <td>{{ admin.name }}</td>
	    <td>{{ admin.pseudo }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}
    <h2>Machines</h2>
    <h4><a class="btn btn-primary btn-sm" role="button" href="{% url 'machines:new-machine' user.id %}"><i class="glyphicon glyphicon-phone"></i> Ajouter une machine</a></h4>
    {% if machines_list %}
    {% include "machines/aff_machines.html" with machines_list=machines_list %}
    {% else %}
    <p>Aucune machine</p>
    {% endif %}
    <h2>Cotisations</h2>
    {% if is_cableur %}<h4><a class="btn btn-primary btn-sm" role="button" href="{% url 'cotisations:new-facture' user.id %}"><i class="glyphicon glyphicon-piggy-bank"></i> Ajouter une cotisation</a>  {% if user_solde %}<a class="btn btn-primary btn-sm" role="button" href="{% url 'cotisations:credit-solde' user.id %}"><i class="glyphicon glyphicon-piggy-bank"></i> Modifier le solde</a>{% endif%}</h4>{% endif%}
    {% if facture_list %}
    {% include "cotisations/aff_cotisations.html" with facture_list=facture_list %}
    {% else %}
    <p>Aucune facture</p>
    {% endif %}
    <h2>Bannissements</h2>
    {% if is_bofh %}<h4><a class="btn btn-primary btn-sm" role="button" href="{% url 'users:add-ban' user.id %}"><i class="glyphicon glyphicon-pushpin"></i> Ajouter un bannissement</a></h4>{% endif %}
    {% if ban_list %}
    {% include "users/aff_bans.html" with ban_list=ban_list %}
    {% else %}
    <p>Aucun bannissement</p>
    {% endif %}
    <h2>Accès à titre gracieux :</h2>
    {% if is_cableur %}<h4><a class="btn btn-primary btn-sm" role="button" href="{% url 'users:add-whitelist' user.id %}"><i class="glyphicon glyphicon-flag"></i> Accorder un accès à titre gracieux</a></h4>{% endif %}
    {% if white_list %}
    {% include "users/aff_whitelists.html" with white_list=white_list %}
    {% else %}
    <p>Aucun accès gracieux</p>
    {% endif %}
    <br />
    <br />
    <br />
{% endblock %}
